<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Félix Marchais">
<meta name="dcterms.date" content="2025-07-29">
<meta name="description" content="Se connecter à tout type de données">

<title>Recueil de données – Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1a9ec17c3750237cc335a9373320045c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/profil.html"> 
<span class="menu-text">Profil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/decouvrir_r.html"> 
<span class="menu-text">Découvrir R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/projets.html"> 
<span class="menu-text">Projets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fmarchais.github.io/tidytuesday/"> 
<span class="menu-text">Tidytuesday</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fmarchais"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../www.linkedin.com/in/félix-marchais"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#csv-en-local" id="toc-csv-en-local" class="nav-link active" data-scroll-target="#csv-en-local">CSV en local</a></li>
  <li><a href="#csv-à-distance" id="toc-csv-à-distance" class="nav-link" data-scroll-target="#csv-à-distance">CSV à distance</a></li>
  <li><a href="#excel" id="toc-excel" class="nav-link" data-scroll-target="#excel">Excel</a></li>
  <li><a href="#parquet" id="toc-parquet" class="nav-link" data-scroll-target="#parquet">Parquet</a></li>
  <li><a href="#connexions-aux-bases-sql" id="toc-connexions-aux-bases-sql" class="nav-link" data-scroll-target="#connexions-aux-bases-sql">Connexions aux bases SQL</a></li>
  <li><a href="#cloud" id="toc-cloud" class="nav-link" data-scroll-target="#cloud">Cloud</a>
  <ul class="collapse">
  <li><a href="#google-cloud-platform" id="toc-google-cloud-platform" class="nav-link" data-scroll-target="#google-cloud-platform">Google Cloud Platform</a></li>
  <li><a href="#aws" id="toc-aws" class="nav-link" data-scroll-target="#aws">AWS</a></li>
  </ul></li>
  <li><a href="#api-rest" id="toc-api-rest" class="nav-link" data-scroll-target="#api-rest">API REST</a></li>
  <li><a href="#webscraping" id="toc-webscraping" class="nav-link" data-scroll-target="#webscraping">Webscraping</a></li>
  <li><a href="#ocr-et-pdf" id="toc-ocr-et-pdf" class="nav-link" data-scroll-target="#ocr-et-pdf">OCR et PDF</a></li>
  <li><a href="#json-et-xml" id="toc-json-et-xml" class="nav-link" data-scroll-target="#json-et-xml">JSON et XML</a>
  <ul class="collapse">
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml">XML</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json">JSON</a></li>
  </ul></li>
  <li><a href="#dicom" id="toc-dicom" class="nav-link" data-scroll-target="#dicom">DICOM</a></li>
  <li><a href="#gpx" id="toc-gpx" class="nav-link" data-scroll-target="#gpx">GPX</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Recueil de données</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Bases de données</div>
  </div>
  </div>

<div>
  <div class="description">
    Se connecter à tout type de données
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Félix Marchais </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 29, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>R est un langage qui permet d’intéragir avec à peu près n’importe quel format de données : </p>
<ul>
<li><p>Des fichiers tabulaires (CSV, Excel, Parquet…), en local ou sur un serveur</p></li>
<li><p>Des bases SQL/NoSQL : MS SQL Server, MySQL, MongoDB, Oracle, DuckDB…</p></li>
<li><p>Des données hébergées sur un cloud (GCP, AWS, Azure…)</p></li>
<li><p>Des données récupérées via du webscraping ou une requête API</p></li>
<li><p>Des données au format JSON ou XML</p></li>
</ul>
<p>Mais pas seulement ! R peut également travailler avec des images (OCRiser un PDF pour récupérer son contenu, ou en générer un), des fichiers DICOM, et bien plus encore.</p>
<section id="csv-en-local" class="level1">
<h1>CSV en local</h1>
<p>Commençons avec le plus simple : les fichiers CSV</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr) <span class="co"># package du Tidyverse</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">"path/to/iris.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa</code></pre>
</div>
</div>
<p>On fait difficilement plus facile. On notera tout de même que <code>{readr}</code> offre des arguments et fonctions supplémentaires pour gérer différents problèmes que l’on rencontre souvent avec le CSV : les séparateurs et l’encodage. </p>
<p>La fonction <code>read_csv</code> lit par défaut des fichiers au “format international” dont le séparateur est une virgule (,) et la décimale un point (.). Cependant, en France (et en Europe), on utilisé généralement la virgule comme séparateur décimal. On a donc inventé le format csv avec séparateur point-virgule (;) et décimale en virgule (,). Pour lire un fichier sous ce format, on peut utiliser la fonction <code>read_csv2()</code> de <code>{readr}</code>. </p>
<p>Pour des formats encore plus exotiques (tsv par exemple), <code>read_delim()</code> permet de préciser le délimiteur. </p>
<p>On notera aussi que les fonctions <code>read_*()</code> fournissent des arguments permettant d’expliciter les valeurs nulles, de retirer les espaces en début/fin de chaîne (ce qui arrive très souvent sur des données saisies à la main dans Excel), de différencier des noms de colonnes en doublons, ou encore de sauter les premières lignes d’un fichier.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv2</span>(<span class="st">"path/to/file_fr.csv"</span>, <span class="co"># lire un fichier au format FR, delim = ;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"NULL"</span>,<span class="st">"NA"</span>), <span class="co"># les cases contenant "","NULL" et "NA" seront vides</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">trim_ws =</span> <span class="cn">TRUE</span>, <span class="co"># trim_whitespace : retirer les espaces en fin de chaîne</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">skip =</span> <span class="dv">1</span>, <span class="co"># sauter la première ligne</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">name_repair =</span> <span class="st">"unique"</span> <span class="co"># différencier les noms en doublons</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="csv-à-distance" class="level1">
<h1>CSV à distance</h1>
<p>Les fonctions <code>read.*()</code> (en base R) et <code>read_*()</code> (<code>{readr}</code>) permettent toutes de charger des fichiers CSV via une URL.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>covid_data <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(<span class="st">"https://www.data.gouv.fr/api/1/datasets/r/fe3e7099-a975-4181-9fb5-2dd1b8f1b552"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(covid_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  fra   strate2 jour       PourAvec tx_indic_7J_DC tx_indic_7J_hosp
  &lt;chr&gt;   &lt;dbl&gt; &lt;date&gt;        &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;           
1 FR          0 2020-03-07        0 0              0               
2 FR          0 2020-03-07        1 &lt;NA&gt;           0               
3 FR          0 2020-03-07        2 &lt;NA&gt;           0               
4 FR          0 2020-03-08        0 0              0               
5 FR          0 2020-03-08        1 &lt;NA&gt;           0               
6 FR          0 2020-03-08        2 &lt;NA&gt;           0               
# ℹ 3 more variables: tx_indic_7J_SC &lt;chr&gt;, tx_prev_hosp &lt;dbl&gt;,
#   tx_prev_SC &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="excel" class="level1">
<h1>Excel</h1>
<p>Les fichiers dits “Excel” ont l’extension .xls ou .xlsx, et peuvent contenir différents feuillets, de la mise en forme, des cellules fusionnées, des formules, des commentaires et des graphes. </p>
<p>Pour lire ces données, il existe plusieurs librairies : <code>{readxl}</code>, <code>{openxslx}</code> ou <code>{openxslx2}</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">"path/to/file.xslx"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">sheet =</span> <span class="dv">1</span>, <span class="co"># feuillet, par numéro ou par nom</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">range =</span> <span class="st">"B3:D87"</span>, <span class="co"># les cellules à garder (optionnel)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>,<span class="st">"NULL"</span>,<span class="st">"NA"</span>), <span class="co"># les cellules à considérer vides</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">.name_repair =</span> <span class="st">"unique"</span> <span class="co"># différencier les noms en doublons</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parquet" class="level1">
<h1>Parquet</h1>
<p>Le format .parquet, encore malheureusement peu connu, est un format compressé et orienté en colonnes, orienté vers la performance. Un même jeu de données au format parquet est entre 5 et 10 fois moins volumineux qu’en csv et est optimisé pour être lu rapidement par R ou Python. On citera aussi sa compatibilité avec DuckDB pour former un duo parfait pour travailler le Big Data avec R. L’un des rares défauts qu’on peut lui trouver est de ne pas être compatible avec Excel, ce qui limite sa diffusion. </p>
<p>Si vous ne l’avez pas encore lu, je vous renvoie vers cet excellent article : <a href="https://www.icem7.fr/cartographie/parquet-devrait-remplacer-le-format-csv/">Parquet devrait remplacer le format CSV</a></p>
<p>Il existe deux méthodes principales pour lire un fichier parquet en R : <code>{arrow}</code>, la librairie de <a href="https://arrow.apache.org/">Apache Arrow</a> et <code>{duckDB}</code>, la librairie de <a href="https://duckdb.org/">DuckDB</a>.</p>
<p>Les deux méthodes permettent de créer une <em>connexion</em> vers le jeu de données, au lieu de les importer dans la mémoire de R, permettant de travailler avec des données pus volumineuses que la RAM. Les deux méthodes permettent d’utiliser <code>{dplyr}</code> pour le requêtage, mais <code>{duckdb}</code> permet aussi de requêter n’importe quel fichier plat en SQL. </p>
<p>On notera également la capacité à lire plusieurs fichiers regroupés dans un dossier (ayant le même schéma), voire même des fichiers partitionnés (<a href="https://arrow.apache.org/docs/r/reference/hive_partition.html">au style Hive</a>), permettant de ne scanner que les données nécessaires, pour optimiser encore plus la performance de requêtage.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrow : </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>arrow_df <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"path/to/file.parquet"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Il est possible de lire directement un ensemble de fichiers .parquet ayant le même schéma </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># et regroupés dans un dossier (données par batch, avec un fichier par mois par exemple)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>arrow_dataset <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(<span class="st">"path/to/folder"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ici, arrow_dataset est une connexion, de classe `Dataset`</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Un `Dataset` de {arrow} se requête avec {dplyr}</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pour récupérer les données dans l'environnement de R : </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>arrow_df <span class="ot">&lt;-</span> arrow_dataset <span class="sc">|&gt;</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(...) <span class="sc">|&gt;</span>  <span class="co"># la plupart des fonctions de {dplyr} sont compatibles</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(...) <span class="sc">|&gt;</span>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>() <span class="co"># pour exécuter la requête et récupérer un tibble/dataframe</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># DuckDB :</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(duckdb)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI) <span class="co"># DataBase Interface</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>conn_ddb <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(<span class="fu">duckdb</span>(), <span class="at">dbdir =</span> <span class="st">":memory:"</span>) <span class="co"># Créer une base duckdb virtuelle</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>duck_df <span class="ot">&lt;-</span> conn_ddb <span class="sc">|&gt;</span> </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl</span>(<span class="st">"path/dataset/**/*.parquet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(...)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Le ** signifie "tout", et permet de lire tous les fichiers .parquet du dossier</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Dans un fichier partitionné par exemple</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>{arrow} renvoie des objets de type <code>arrow_table</code> ou <code>Dataset</code>, qui ne sont compatibles qu’avec les fonctions de <code>{dplyr}</code>. Si vous souhaitez modifier une colonne avec une fonction de <code>{purrr}</code>, <code>{lubridate}</code> ou <code>{stringr}</code>, il faudra d’abord utiliser <code>collect()</code> pour obtenir un <code>tibble</code>. </p>
<p>A l’inverse, <code>{duckdb}</code> renvoie des objets de classe <code>tbl</code> (donc des <code>tibble</code>). Si l’on ajoute l’incroyable performance de requêtage du moteur duckdb, j’aurais plutôt tendance à privilégier cette méthode</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Info
</div>
</div>
<div class="callout-body-container callout-body">
<p>Récemment, <code>{duckplyr}</code>, une librairie intégrant <code>{dplyr}</code> avec le moteur de <code>{duckdb}</code> <a href="https://www.tidyverse.org/blog/2025/06/duckplyr-1-1-0/">a rejoint le <code>Tidyverse</code></a>, signe que Duckdb est perçu comme un outil d’avenir.</p>
</div>
</div>
</section>
<section id="connexions-aux-bases-sql" class="level1">
<h1>Connexions aux bases SQL</h1>
<p>Si vous utilisez Rstudio, le moyen le plus simple de se connecter à une source de données est d’utiliser l’onglet <em>Connections</em>, généralement situé en haut à droite, avec votre <em>Environnement</em>. En cliquant sur <em>New connection</em>, une fenêtre apparaît et va automatiquement vous proposer les sources à disposition. </p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/rstudio_connections.png" class="img-fluid figure-img"></p>
<figcaption>Exemple des connexions existantes sur mon poste</figcaption>
</figure>
</div>
<p>Si vous avez déjà configuré un DSN contenant vos identifiants, les informations de connexion devraient déjà être remplies, vous n’avez plus qu’à cliquer sur “OK”, et le code s’exécutera dans la console. Vous pourrez alors visualiser vos bases dans l’onglet <em>Connections</em></p>
<p><img src="../../images/rstudio_connections_dsn.png" class="img-fluid" width="515"></p>
<p>Sinon, vous aurez besoin d’entrer les paramètres suivants :</p>
<ul>
<li><p><em>user</em> = “…” pour le nom d’utilisateur</p></li>
<li><p><em>password</em> = “…” pour le mot de passe</p></li>
<li><p><em>host</em> et <em>port</em> si besoin</p></li>
<li><p><em>dbname</em> pour le nom de la base de données</p></li>
</ul>
<p>Si vous utilisez uniquement la console, vous pouvez rentrer directement les paramètres dans <code>dbConnect()</code>, en arguments de la fonction.</p>
<p>Une fois connecté, on peut requêter ses données avec <code>{dplyr}</code> ou en SQL, en utilisant <code>dbGetQuery()</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(odbc)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(odbc<span class="sc">::</span><span class="fu">odbc</span>() ,<span class="st">"server-name"</span>, <span class="at">database =</span> <span class="st">"MA_BASE"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ma_table <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(conn, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"SELECT * FROM MA_TABLE</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">                            WHERE ..."</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># DPLYR</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>ma_table_2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tbl</span>(conn, <span class="st">"MA_TABLE"</span>) <span class="sc">|&gt;</span>  <span class="co"># ici, on créé une connexion à la table</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(...) <span class="sc">|&gt;</span>  <span class="co"># on créé la requête</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">collect</span>() <span class="co"># et on collecte le résultat dans R avec collect()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Pour interagir avec une base SQL pour autre chose qu’une requête (UPDATE, DROP, …), on peut utiliser la librairie <code>{dbplyr}</code>, un back-end de <code>{dplyr}</code> pour les bases de données, ou utiliser <code>DBI::dbExecute()</code></p>
</section>
<section id="cloud" class="level1">
<h1>Cloud</h1>
<p>R dispose de nombreuses librairies pour récupérer des données hébergées sur un serveur cloud. Je n’entrerai pas dans les détails de cette partie, car je n’ai pas encore eu beaucoup l’occasion de pratiquer par moi-même, mais je penserai à la mettre à jour dès que possible. </p>
<section id="google-cloud-platform" class="level2">
<h2 class="anchored" data-anchor-id="google-cloud-platform">Google Cloud Platform</h2>
<p>Voici une liste non exhaustive des librairies permettant de travailler avec Google Cloud Platform, disponible sur la vignette de <a href="https://code.markedmondson.me/googleAuthR/"><code>{googleAuthR}</code></a></p>
<ul>
<li><p><a href="https://cloudyr.github.io/googleComputeEngineR/">googleComputeEngineR</a> - Google Compute Engine VMs API</p></li>
<li><p><a href="https://code.markedmondson.me/searchConsoleR/">searchConsoleR</a> - Search Console API</p></li>
<li><p><a href="https://code.markedmondson.me/bigQueryR/">bigQueryR</a> - BigQuery API. Part of the cloudyr project.</p></li>
<li><p><a href="https://code.markedmondson.me/googleAnalyticsR/">googleAnalyticsR</a> - Google Analytics API</p></li>
<li><p><a href="https://github.com/IronistM/googleTagManageR">googleTagManagerR</a> - Google Tag Manager API by IronistM</p></li>
<li><p><a href="https://github.com/MarkEdmondson1234/googleID">googleID</a> - Simple user info from G+ API for Shiny app authentication flows.</p></li>
<li><p><a href="https://code.markedmondson.me/googleCloudStorageR/">googleCloudStorageR</a> - Google Cloud Storage API</p></li>
<li><p><a href="https://github.com/cloudyr/googleCloudVisionR">RoogleVision</a> - R Package for Image Recogntion, Object Detection, and OCR using the Google’s Cloud Vision API</p></li>
<li><p><a href="https://github.com/ropensci/googleLanguageR">googleLanguageR</a> - Access Speech to Text, Entity analysis and translation APIs from R</p></li>
<li><p><a href="https://code.markedmondson.me/googleCloudRunner/">googleCloudRunner</a> - Continuous Development and Integration with Cloud Run, Cloud Scheduler and Cloud Build</p></li>
</ul>
</section>
<section id="aws" class="level2">
<h2 class="anchored" data-anchor-id="aws">AWS</h2>
<p>La documentation officielle de Amazon Web Service dispose <a href="https://aws.amazon.com/fr/blogs/opensource/getting-started-with-r-on-amazon-web-services/">d’un tutoriel</a> pour accéder aux données du service depuis R.</p>
</section>
</section>
<section id="api-rest" class="level1">
<h1>API REST</h1>
<p>Le plus simple selon moi pour requêter une API REST avec R est d’utiliser l’excellent <code>{httr2}</code> de Hadley Wickham (que vous connaissez déjà certainement si vous utilisez le Tidyverse). La documentation du package est disponible <a href="https://httr2.r-lib.org/">ici</a></p>
<p>La première chose à faire est évidemment de lire la documentation de l’API que l’on souhaite requêter. Pour vous entraîner, vous pouvez utiliser <a href="https://www.data.gouv.fr/dataservices">une des API disponibles sur data.gouv.fr</a>. Pour cet exemple, j’utiliserai <a href="https://hubeau.eaufrance.fr/page/api-qualite-eau-potable#console">l’API de Hub’eau pour la qualité de l’eau potable en France</a>. </p>
<p>Une fois rendus sur le site, la documentation nous indique que la “Base URL” est hubeau.eaufrance.fr/api, puis nous indique les extensions à ajouter selon ce que l’on souhaite requêter (liste des communes ou résultats), puis les parmètres de filtrage</p>
<p>On utilisera également la librairie <code>{jsonlite}</code> pour convertir les données récupérées au format JSON en un data.frame</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Astuce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le package <code>{httr2}</code> nécessite l’installation du package <code>{curl}</code>, qui peut poser problème si vous êtes sur un réseau professionnel protégé par un pare-feu. Dans ce cas, contactez votre DSI, ou … faites un partage de connexion depuis votre téléphone 🤫</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"http://hubeau.eaufrance.fr/api"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(base_url) <span class="sc">|&gt;</span>  <span class="co"># pointer vers l'url de base</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">"/v1/qualite_eau_potable/resultats_dis"</span>) <span class="sc">|&gt;</span> <span class="co">#extension</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="at">code_departement =</span> <span class="st">"85"</span>) <span class="sc">|&gt;</span> <span class="co"># paramètres de la requête</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="at">size =</span> <span class="st">"50"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(    </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fields =</span> <span class="fu">c</span>(<span class="st">'libelle_parametre'</span>,<span class="st">'libelle_parametre_maj'</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">'resultat_numerique'</span>, <span class="st">'libelle_unite'</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">'limite_qualite_parametre'</span>,<span class="st">'reference_qualite_parametre'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">'nom_commune'</span>,<span class="st">'date_prelevement'</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">'conclusion_conformite_prelevement'</span>), </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.multi =</span> <span class="st">"comma"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(req)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>df_data <span class="ot">&lt;-</span> resp <span class="sc">|&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_string</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fromJSON</span>()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>df_data <span class="ot">&lt;-</span> df_data<span class="sc">$</span>data</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    libelle_parametre
1                  Cel. de cyanobactéries toxinogènes
2 Cyanobactéries toxinogènes (exprimées en biovolume)
3           Numération des cellules de phytoplanctons
4                          Cellules de cyanobactéries
5                              Microcystine-RR totale
6          Somme des microcystines analysées (calcul)
                       libelle_parametre_maj resultat_numerique  libelle_unite
1         CEL. DE CYANOBACTÉRIES TOXINOGÈNES              0.041 n(cellules)/mL
2                 CYANOBACTÉRIES TOXINOGÈNES              0.732          mm3/L
3                 CELLULES DE PHYTOPLANCTONS              1.000 n(cellules)/mL
4                 CELLULES DE CYANOBACTÉRIES              0.041 n(cellules)/mL
5                     MICROCYSTINE-RR TOTALE              0.000           µg/L
6 SOMME DES MICROCYSTINES ANALYSÉES (CALCUL)              0.000           µg/L
  limite_qualite_parametre reference_qualite_parametre nom_commune
1                     &lt;NA&gt;                        &lt;NA&gt;    APREMONT
2                     &lt;NA&gt;                        &lt;NA&gt;    APREMONT
3                     &lt;NA&gt;                        &lt;NA&gt;    APREMONT
4                     &lt;NA&gt;                        &lt;NA&gt;    APREMONT
5                 &lt;=1 µg/L                        &lt;NA&gt;    APREMONT
6                 &lt;=1 µg/L                        &lt;NA&gt;    APREMONT
      date_prelevement
1 2025-06-30T14:00:00Z
2 2025-06-30T14:00:00Z
3 2025-06-30T14:00:00Z
4 2025-06-30T14:00:00Z
5 2025-06-30T13:55:00Z
6 2025-06-30T13:55:00Z
                                                                        conclusion_conformite_prelevement
1 Eau d'alimentation conforme aux exigences de qualité en vigueur pour l'ensemble des paramètres mesurés.
2 Eau d'alimentation conforme aux exigences de qualité en vigueur pour l'ensemble des paramètres mesurés.
3 Eau d'alimentation conforme aux exigences de qualité en vigueur pour l'ensemble des paramètres mesurés.
4 Eau d'alimentation conforme aux exigences de qualité en vigueur pour l'ensemble des paramètres mesurés.
5 Eau d'alimentation conforme aux exigences de qualité en vigueur pour l'ensemble des paramètres mesurés.
6 Eau d'alimentation conforme aux exigences de qualité en vigueur pour l'ensemble des paramètres mesurés.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Cacher les clés API
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dans le cas où vous utilisez une API privée nécessitant une clé, il est judicieux d’éviter de stocker vos identifiants dans le script R. Pour cela, vous pouvez utiliser un fichier <a href="https://docs.posit.co/ide/user/ide/guide/environments/r/managing-r.html">.Rprofile</a>, stocké sur votre machine locale, et qui se lance quand vous démarrez votre IDE. Ainsi, vos identifiants sont présents dans votre environnement sans avoir à les déclarer dans le script. Si vous hébergez votre code sur GitHub, vous pouvez inclure le .Rprofile dans le .gitignore pour éviter de les inclure dans le repo, et utiliser la fonction <a href="https://docs.github.com/fr/actions/how-tos/write-workflows/choose-what-workflows-do/use-secrets"><em>Github Secrets</em></a> pour remplacer le .Rprofile.</p>
</div>
</div>
</section>
<section id="webscraping" class="level1">
<h1>Webscraping</h1>
<p>Si vous souhaitez récupérer des données sur un site web qui ne propose pas d’API, l’une des solutions est le <a href="https://fr.wikipedia.org/wiki/Web_scraping"><em>web scraping</em></a>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Attention
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tous les sites n’autorisent pas le web scraping, et les données doivent être <em>nativement</em> publiques, <em>tombées</em> dans le domaine publique ou sous licence libre <em>si votre usage n’est pas commercial</em>. Renseignez-vous avant de scraper une page !</p>
</div>
</div>
<p>Le principal package de web scraping en R est <a href="https://rvest.tidyverse.org/index.html"><code>{rvest}</code></a> (toujours développé par Hadley Wickham). Pour cet exemple, j’utiliserai aussi <a href="https://dmi3kno.github.io/polite/index.html"><code>{polite}</code></a>, un package qui permet de suivre 3 règles d’éthique lors d’une session de scraping : <em>“Demander la permission, prendre doucement et ne jamais demander deux fois”</em>. Ces règles permettent d’éviter de causer des problèmes en récoltant des données non autorisées ou en surchargeant le serveur de requêtes, et nous éviterons d’être bannis par les administrateurs du site scrapé.</p>
<p>Dans cet exemple, nous allons récupérer une table contenant la liste des communes de Vendée, sur <a href="https://fr.wikipedia.org/wiki/Liste_des_communes_de_la_Vend%C3%A9e">cette page wikipédia</a></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polite)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://fr.wikipedia.org/wiki/Liste_des_communes_de_la_Vend%C3%A9e"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>session <span class="ot">&lt;-</span> polite<span class="sc">::</span><span class="fu">bow</span>(url) </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Bow permet d'interroger le robots.txt et nous informe du résultat</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># il enregistre notamment le délai minimum de requêtage autorisé par le site</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>session</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>page <span class="ot">&lt;-</span> polite<span class="sc">::</span><span class="fu">scrape</span>(session)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># scrape() récupère le contenu autorisé</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>cities_table <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_element</span>(<span class="st">"table.wikitable"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  rvest<span class="sc">::</span><span class="fu">html_table</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># html_element récupère le premier élément de la classe "table.wikitable"</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># pour tous les récupérer sous forme de liste : html_elements()</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># html_table() permet de convertir des données tabulaires en un dataframe</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cities_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  Nom             CodeInsee `Code postal` Arrondissement Canton Intercommunalité
  &lt;chr&gt;               &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;           
1 La Roche-sur-Y…     85191         85000 La Roche-sur-… La Ro… CA La Roche-sur…
2 Les Achards         85152         85150 Les Sables-d’… Talmo… Pays-des-Achards
3 L'Aiguillon-la…     85001         85460 Les Sables-d'… Mareu… CC Sud-Vendée-L…
4 L'Aiguillon-su…     85002         85220 Les Sables-d'… Saint… CA Pays de Sain…
5 Aizenay             85003         85190 La Roche-sur-… Aizen… CC de Vie-et-Bo…
6 Angles              85004         85750 Les Sables-d'… Mareu… CC Vendée-Grand…
# ℹ 4 more variables: `Superficie(km2)` &lt;chr&gt;,
#   `Population(dernière pop. légale)` &lt;chr&gt;, `Densité(hab./km2)` &lt;chr&gt;,
#   Modifier &lt;lgl&gt;</code></pre>
</div>
</div>
</section>
<section id="ocr-et-pdf" class="level1">
<h1>OCR et PDF</h1>
<p>Dans le domaine de la santé, les compte-rendus médicaux contiennent énormément de données intéressantes, mais sont malheureusement difficilement exploitables car dans un format non-structuré : un papier scanné et stocké en PDF.</p>
<p>L’OCR (Optical Character Recognition) est un système de <em>machine learning</em> permettant d’extraire le texte présent sur une image, parfait donc pour exploiter un grand nombre de comtpe-rendus scannés sans avoir à le faire manuellement.</p>
<p>Dans cet exemple, nous utiliserons le modèle <strong>Tesseract</strong>, développé par Google et aujourd’hui Open Source. Nous utiliserons également la librairie <code>doParallel</code> pour paralléliser le traitement des images et augmenter la vitesse d’OCRisation</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tesseract)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupérer le chemin de tous les fichiers PDF présents dans un dossier</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>list_pdf <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"path/to/folder"</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.pdf$"</span>, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">all.files =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">recursive =</span> <span class="cn">FALSE</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">&lt;-</span> doParallel<span class="sc">::</span><span class="fu">detectCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>) <span class="co"># compter les coeurs physiques </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le cluster, en laissant 2 coeurs non utilisés</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> doParallel<span class="sc">::</span><span class="fu">makeCluster</span>(ncores<span class="dv">-2</span>)   </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># et pour arrêter : stopCluster(cl)</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Charger les librariries et les objets dans les clusters</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="do">## clusterEvalQ() : exécute le code dans le cluster</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterEvalQ</span>(cl, {</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse);</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tesseract);</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pdftools)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="do">## clusterExport() charge l'objet dans le cluster</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterExport</span>(cl, <span class="fu">c</span>(<span class="st">"list_pdf"</span>))</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer une fonction qui renvoie un dataframe en sortie (1 ligne par page)</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>myPdfConvert <span class="ot">&lt;-</span> <span class="cf">function</span>(list_objet) { </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  list_objet <span class="sc">%&gt;%</span> <span class="fu">map_df</span>(<span class="sc">~</span> <span class="fu">data.frame</span>(<span class="at">doc_origin =</span> .x, <span class="co">#.x = chaque élément de listobjet</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">texte =</span> <span class="fu">ocr</span>(pdftools<span class="sc">::</span><span class="fu">pdf_convert</span>(.x, <span class="at">dpi =</span> <span class="dv">200</span>)) <span class="co"># océrise un pdf converti en png</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                                     ))</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Appliquer la fonction myPdfConvert à chaque élément de list_pdf</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">parLapply</span>(cl, list_pdf, myPdfConvert)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Le résultat est obtenu sous forme de liste (1 élément par cluster) =&gt; les recombiner</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">"rbind"</span>, res)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrêter le cluster</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour récupérer numéro de page et nom du doc à chaque ligne (1 ligne = 1 page)</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>resr <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_origin) <span class="sc">%&gt;%</span> </span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doc_page =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="at">doc_nom =</span> <span class="fu">str_extract_all</span>(doc_origin, <span class="st">"[[:alnum:]_ ]*</span><span class="sc">\\</span><span class="st">.pdf"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Pour visualiser l’impact de la parallélisation :</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="decouvrir_connections_files/figure-html/ocr2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="json-et-xml" class="level1">
<h1>JSON et XML</h1>
<p>Les formats <strong>XML</strong> (eXtensible Markup Language) et <strong>JSON</strong> (JavaScript Object Notation) sont largement utilisés pour le stockage et l’échange de données, notamment dans les <strong>API REST</strong>, les <strong>flux RSS</strong>, ou le stockage de données hiérarchiques .</p>
<p>Pour lire les fichiers XML, on utilisera<code>{xml2}</code> et pour JSON :<code>{jsonlite}</code> (il en existe de nombreuses autres, mais ce sont les plus connues)</p>
<section id="xml" class="level2">
<h2 class="anchored" data-anchor-id="xml">XML</h2>
<p>Supposons que nous ayons un fichier “livres.xml” ressemblant à cela :</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>xml_doc <span class="ot">&lt;-</span> <span class="fu">as_xml_document</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="st">"&lt;livres&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;livre&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;titre&gt;R pour les débutants&lt;/titre&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;auteur&gt;Jean Martin&lt;/auteur&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;annee&gt;2020&lt;/annee&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/livre&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;livre&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;titre&gt;Analyse de données avec R&lt;/titre&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;auteur&gt;Marie Dupont&lt;/auteur&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;annee&gt;2021&lt;/annee&gt;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/livre&gt;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/livres&gt;"</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Pour lire le fichier .xml, on utilisera</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>xml_doc <span class="ot">&lt;-</span> xml2<span class="sc">::</span><span class="fu">read_xml</span>(<span class="st">"livres.xml"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Ensuite, on peut extraire les titres avec</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>titres_xml <span class="ot">&lt;-</span> <span class="fu">xml_find_all</span>(xml_doc, <span class="st">".//livre/titre"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(titres_xml)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{xml_nodeset (2)}
[1] &lt;titre&gt;R pour les débutants&lt;/titre&gt;
[2] &lt;titre&gt;Analyse de données avec R&lt;/titre&gt;</code></pre>
</div>
</div>
<p>Les fonctions <code>xml_find_*()</code> permettent d’utiliser des expression <strong>xpath</strong>, similaire à du <strong>REGEX</strong> mais pour les architectures en arbre et renvoient des objets de classe <code>xml_nodeset</code>. Pour récupérer un vecteur <code>character</code>, on rajoute simplement <code>xml_text()</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>titres <span class="ot">&lt;-</span> <span class="fu">xml_text</span>(titres_xml)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(titres)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "R pour les débutants"      "Analyse de données avec R"</code></pre>
</div>
</div>
</section>
<section id="json" class="level2">
<h2 class="anchored" data-anchor-id="json">JSON</h2>
<p>Pour lire du JSON, on utilisera simplement <code>fromJSON()</code>, pour convertir une chaîne de texte, ou <code>read_json()</code> pour lire un fichier .json. Les deux fonctions renvoient directement un <code>data.frame</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>livres_json <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">[</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">  {</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">    "titre": "R pour les débutants",</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="st">    "auteur": "Jean Dupont",</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="st">    "annee": 2020</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">  },</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="st">  {</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">    "titre": "Analyse de données avec R",</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">    "auteur": "Marie Curie",</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">    "annee": 2021</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">]</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">'</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(livres_json)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>                  titre      auteur annee</code></pre>
<p>1 R pour les débutants Jean Dupont 2020 2 Analyse de données avec R Marie Curie 2021</p>
<p>On citera aussi la possibilité de convertir un objet R en JSON avec la fonction <code>toJSON()</code>.</p>
</section>
</section>
<section id="dicom" class="level1">
<h1>DICOM</h1>
<p>Sans rentrer dans les détails ici, le format DICOM (Digital Imaging and Communications in Medicine) est un standard pour l’imagerie médicale. le package <code>{Espadon}</code> <a href="https://espadon.cnrs.fr/">développé par le CNRS</a> permet d’interagir avec ce format</p>
</section>
<section id="gpx" class="level1">
<h1>GPX</h1>
<p>GPX est un format pour les données géospatiales, qui permet par exemple de créer un itinéraire sur une carte. <a href="https://www.appsilon.com/post/r-gpx-files">Cet article</a> explique très bien comment lire ce standard, souvent stocké au format XML.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/fmarchais\.github\.io\/portfolio\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>